[2025-09-10T13:48:03.365+0000] {taskinstance.py:1103} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: kafka_to_postgres_batch.consume_and_save_batch manual__2025-09-10T13:47:44.858943+00:00 [queued]>
[2025-09-10T13:48:03.390+0000] {taskinstance.py:1103} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: kafka_to_postgres_batch.consume_and_save_batch manual__2025-09-10T13:47:44.858943+00:00 [queued]>
[2025-09-10T13:48:03.391+0000] {taskinstance.py:1308} INFO - Starting attempt 1 of 3
[2025-09-10T13:48:03.425+0000] {taskinstance.py:1327} INFO - Executing <Task(PythonOperator): consume_and_save_batch> on 2025-09-10 13:47:44.858943+00:00
[2025-09-10T13:48:03.435+0000] {standard_task_runner.py:57} INFO - Started process 1134 to run task
[2025-09-10T13:48:03.440+0000] {standard_task_runner.py:84} INFO - Running: ['***', 'tasks', 'run', 'kafka_to_postgres_batch', 'consume_and_save_batch', 'manual__2025-09-10T13:47:44.858943+00:00', '--job-id', '109', '--raw', '--subdir', 'DAGS_FOLDER/dags.py', '--cfg-path', '/tmp/tmpoqs3hq3c']
[2025-09-10T13:48:03.443+0000] {standard_task_runner.py:85} INFO - Job 109: Subtask consume_and_save_batch
[2025-09-10T13:48:03.477+0000] {logging_mixin.py:150} WARNING - /home/***/.local/lib/python3.7/site-packages/***/settings.py:195 DeprecationWarning: The sql_alchemy_conn option in [core] has been moved to the sql_alchemy_conn option in [database] - the old setting has been used, but please update your config.
[2025-09-10T13:48:03.549+0000] {task_command.py:410} INFO - Running <TaskInstance: kafka_to_postgres_batch.consume_and_save_batch manual__2025-09-10T13:47:44.858943+00:00 [running]> on host c905ba028b15
[2025-09-10T13:48:04.029+0000] {taskinstance.py:1547} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='kafka_to_postgres_batch' AIRFLOW_CTX_TASK_ID='consume_and_save_batch' AIRFLOW_CTX_EXECUTION_DATE='2025-09-10T13:47:44.858943+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='manual__2025-09-10T13:47:44.858943+00:00'
[2025-09-10T13:48:04.034+0000] {dags_utils.py:42} INFO - Starting consumer with batch_size=50, timeout=30
[2025-09-10T13:48:04.044+0000] {conn.py:397} INFO - <BrokerConnection client_id=kafka-python-2.2.15, node_id=bootstrap-0 host=kafka:9092 <connecting> [IPv4 ('172.23.0.5', 9092)]>: connecting to kafka:9092 [('172.23.0.5', 9092) IPv4]
[2025-09-10T13:48:04.238+0000] {conn.py:618} INFO - <BrokerConnection client_id=kafka-python-2.2.15, node_id=bootstrap-0 host=kafka:9092 <checking_api_versions_recv> [IPv4 ('172.23.0.5', 9092)]>: Broker version identified as 2.6
[2025-09-10T13:48:04.239+0000] {conn.py:457} INFO - <BrokerConnection client_id=kafka-python-2.2.15, node_id=bootstrap-0 host=kafka:9092 <connected> [IPv4 ('172.23.0.5', 9092)]>: Connection complete.
[2025-09-10T13:48:04.241+0000] {subscription_state.py:181} INFO - Updating subscribed topics to: ('user_events',)
[2025-09-10T13:48:04.272+0000] {conn.py:397} INFO - <BrokerConnection client_id=kafka-python-2.2.15, node_id=1 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: connecting to host.docker.internal:9092 [('192.168.65.254', 9092) IPv4]
[2025-09-10T13:48:04.375+0000] {conn.py:457} INFO - <BrokerConnection client_id=kafka-python-2.2.15, node_id=1 host=host.docker.internal:9092 <connected> [IPv4 ('192.168.65.254', 9092)]>: Connection complete.
[2025-09-10T13:48:04.377+0000] {conn.py:945} INFO - <BrokerConnection client_id=kafka-python-2.2.15, node_id=bootstrap-0 host=kafka:9092 <connected> [IPv4 ('172.23.0.5', 9092)]>: Closing connection. 
[2025-09-10T13:48:04.531+0000] {cluster.py:401} INFO - Coordinator for group/***_batch_consumer is ('coordinator-1', 'host.docker.internal', 9092, None)
[2025-09-10T13:48:04.534+0000] {base.py:789} INFO - Discovered coordinator coordinator-1 for group ***_batch_consumer
[2025-09-10T13:48:04.535+0000] {base.py:848} INFO - Starting new heartbeat thread
[2025-09-10T13:48:04.537+0000] {consumer.py:366} INFO - Revoking previously assigned partitions () for group ***_batch_consumer
[2025-09-10T13:48:04.538+0000] {base.py:419} INFO - Failed to join group ***_batch_consumer: NodeNotReadyError: coordinator-1
[2025-09-10T13:48:04.542+0000] {conn.py:397} INFO - <BrokerConnection client_id=kafka-python-2.2.15, node_id=coordinator-1 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: connecting to host.docker.internal:9092 [('192.168.65.254', 9092) IPv4]
[2025-09-10T13:48:04.643+0000] {base.py:419} INFO - Failed to join group ***_batch_consumer: NodeNotReadyError: coordinator-1
[2025-09-10T13:48:04.644+0000] {conn.py:457} INFO - <BrokerConnection client_id=kafka-python-2.2.15, node_id=coordinator-1 host=host.docker.internal:9092 <connected> [IPv4 ('192.168.65.254', 9092)]>: Connection complete.
[2025-09-10T13:48:04.745+0000] {base.py:532} INFO - (Re-)joining group ***_batch_consumer
[2025-09-10T13:48:04.881+0000] {base.py:638} INFO - Received member id kafka-python-2.2.15-4df70a1d-c893-4e03-908e-ee6c7ba1c2de for group ***_batch_consumer; will retry join-group
[2025-09-10T13:48:04.882+0000] {base.py:419} INFO - Failed to join group ***_batch_consumer: [Error 79] MemberIdRequiredError
[2025-09-10T13:48:04.882+0000] {base.py:532} INFO - (Re-)joining group ***_batch_consumer
[2025-09-10T13:48:08.003+0000] {base.py:594} INFO - Successfully joined group ***_batch_consumer <Generation 15 (member_id: kafka-python-2.2.15-4df70a1d-c893-4e03-908e-ee6c7ba1c2de, protocol: range)>
[2025-09-10T13:48:08.004+0000] {base.py:597} INFO - Elected group leader -- performing partition assignments using range
[2025-09-10T13:48:08.078+0000] {subscription_state.py:254} INFO - Updated partition assignment: [('user_events', 0)]
[2025-09-10T13:48:08.079+0000] {consumer.py:250} INFO - Setting newly assigned partitions (('user_events', 0),) for group ***_batch_consumer
[2025-09-10T13:48:08.106+0000] {dags_utils.py:70} INFO - Received message 1: {'user_id': 961, 'event_type': 'view_product', 'city': 'Antarctica', 'country': 'Antarctica', 'lat': -74.34538562903197, 'lon': 86.50927666303102, 'cost_usd': 234.0, 'cost_eur': 199.6, 'cost_rub': 19559.23, 'weather_temp': -37.86, 'weather_desc': 'overcast clouds', 'timestamp': '2025-09-10T13:32:39.506069+00:00'}
[2025-09-10T13:48:08.106+0000] {dags_utils.py:70} INFO - Received message 2: {'user_id': 365, 'event_type': 'purchase', 'city': 'Tamanghasset', 'country': 'Algeria', 'lat': 25.764234484774832, 'lon': 3.479477706814606, 'cost_usd': 4.57, 'cost_eur': 3.9, 'cost_rub': 381.99, 'weather_temp': 40.79, 'weather_desc': 'clear sky', 'timestamp': '2025-09-10T13:45:31.051276+00:00'}
[2025-09-10T13:48:08.107+0000] {dags_utils.py:70} INFO - Received message 3: {'user_id': 871, 'event_type': 'purchase', 'city': 'Ganja-Gazakh', 'country': 'Azerbaijan', 'lat': 41.14593666924541, 'lon': 45.656608970945285, 'cost_usd': 308.43, 'cost_eur': 263.09, 'cost_rub': 25780.57, 'weather_temp': 28.33, 'weather_desc': 'clear sky', 'timestamp': '2025-09-10T13:45:32.919764+00:00'}
[2025-09-10T13:48:08.107+0000] {dags_utils.py:70} INFO - Received message 4: {'user_id': 212, 'event_type': 'purchase', 'city': 'Seruyan', 'country': 'Indonesia', 'lat': -1.342311047207204, 'lon': 111.9042714133617, 'cost_usd': 138.99, 'cost_eur': 118.56, 'cost_rub': 11617.68, 'weather_temp': 22.69, 'weather_desc': 'overcast clouds', 'timestamp': '2025-09-10T13:45:35.951887+00:00'}
[2025-09-10T13:48:08.107+0000] {dags_utils.py:70} INFO - Received message 5: {'user_id': 715, 'event_type': 'purchase', 'city': 'Antarctica', 'country': 'Antarctica', 'lat': -82.98507685867068, 'lon': 3.4401919075298224, 'cost_usd': 743.72, 'cost_eur': 634.38, 'cost_rub': 62164.92, 'weather_temp': -41.74, 'weather_desc': 'overcast clouds', 'timestamp': '2025-09-10T13:45:37.156189+00:00'}
[2025-09-10T13:48:08.108+0000] {dags_utils.py:70} INFO - Received message 6: {'user_id': 916, 'event_type': 'add_to_cart', 'city': 'Central Southern Red Sea', 'country': 'Eritrea', 'lat': 13.839683221659485, 'lon': 41.373754099305614, 'cost_usd': 56.14, 'cost_eur': 47.89, 'cost_rub': 4692.54, 'weather_temp': 36.62, 'weather_desc': 'broken clouds', 'timestamp': '2025-09-10T13:45:38.775331+00:00'}
[2025-09-10T13:48:08.108+0000] {dags_utils.py:70} INFO - Received message 7: {'user_id': 818, 'event_type': 'session_start', 'city': 'Bungendore', 'country': 'Australia', 'lat': -35.26112499882626, 'lon': 149.46939952528794, 'cost_usd': 715.99, 'cost_eur': 610.73, 'cost_rub': 59847.07, 'weather_temp': 5.9, 'weather_desc': 'moderate rain', 'timestamp': '2025-09-10T13:45:40.250196+00:00'}
[2025-09-10T13:48:08.108+0000] {dags_utils.py:70} INFO - Received message 8: {'user_id': 474, 'event_type': 'session_start', 'city': 'Unknown', 'country': None, 'lat': 74.89834494032449, 'lon': -140.85705622766443, 'cost_usd': 166.19, 'cost_eur': 141.76, 'cost_rub': 13891.23, 'weather_temp': -2.28, 'weather_desc': 'overcast clouds', 'timestamp': '2025-09-10T13:45:43.397696+00:00'}
[2025-09-10T13:48:08.109+0000] {dags_utils.py:70} INFO - Received message 9: {'user_id': 723, 'event_type': 'add_to_cart', 'city': 'Antarctica', 'country': 'Antarctica', 'lat': -89.02968298021884, 'lon': 141.0156463028863, 'cost_usd': 781.4, 'cost_eur': 666.52, 'cost_rub': 65314.46, 'weather_temp': -43.94, 'weather_desc': 'overcast clouds', 'timestamp': '2025-09-10T13:45:49.007873+00:00'}
[2025-09-10T13:48:08.109+0000] {dags_utils.py:70} INFO - Received message 10: {'user_id': 48, 'event_type': 'view_product', 'city': 'Santa Rita do Trivelato', 'country': 'Brazil', 'lat': -13.500976950917135, 'lon': -55.63602997824127, 'cost_usd': 526.01, 'cost_eur': 448.68, 'cost_rub': 43967.31, 'weather_temp': 35.61, 'weather_desc': 'clear sky', 'timestamp': '2025-09-10T13:45:52.908545+00:00'}
[2025-09-10T13:48:08.109+0000] {dags_utils.py:70} INFO - Received message 11: {'user_id': 892, 'event_type': 'view_product', 'city': 'Antarctica', 'country': 'Antarctica', 'lat': -86.06378577090123, 'lon': -14.932407873348637, 'cost_usd': 390.66, 'cost_eur': 333.23, 'cost_rub': 32653.89, 'weather_temp': -35.57, 'weather_desc': 'overcast clouds', 'timestamp': '2025-09-10T13:45:55.311110+00:00'}
[2025-09-10T13:48:08.110+0000] {dags_utils.py:70} INFO - Received message 12: {'user_id': 513, 'event_type': 'view_product', 'city': 'Znamenskiy', 'country': 'Russia', 'lat': 57.283922919080794, 'lon': 73.26295552113271, 'cost_usd': 873.15, 'cost_eur': 744.78, 'cost_rub': 72983.52, 'weather_temp': 11.42, 'weather_desc': 'overcast clouds', 'timestamp': '2025-09-10T13:45:55.562341+00:00'}
[2025-09-10T13:48:08.110+0000] {dags_utils.py:70} INFO - Received message 13: {'user_id': 407, 'event_type': 'add_to_cart', 'city': 'Koulpélogo', 'country': 'Burkina Faso', 'lat': 11.147505971761348, 'lon': 0.3528606002040817, 'cost_usd': 490.01, 'cost_eur': 417.97, 'cost_rub': 40958.2, 'weather_temp': 29.99, 'weather_desc': 'broken clouds', 'timestamp': '2025-09-10T13:45:56.701940+00:00'}
[2025-09-10T13:48:08.110+0000] {dags_utils.py:70} INFO - Received message 14: {'user_id': 301, 'event_type': 'purchase', 'city': 'Kivalliq', 'country': 'Canada', 'lat': 81.39782107813691, 'lon': -73.9676283358217, 'cost_usd': 922.44, 'cost_eur': 786.83, 'cost_rub': 77103.49, 'weather_temp': -11.29, 'weather_desc': 'overcast clouds', 'timestamp': '2025-09-10T13:46:00.146680+00:00'}
[2025-09-10T13:48:08.110+0000] {dags_utils.py:70} INFO - Received message 15: {'user_id': 127, 'event_type': 'session_start', 'city': 'Porto Walter', 'country': 'Brazil', 'lat': -8.603534655309844, 'lon': -72.36833728474338, 'cost_usd': 17.63, 'cost_eur': 15.04, 'cost_rub': 1473.63, 'weather_temp': 28.49, 'weather_desc': 'clear sky', 'timestamp': '2025-09-10T13:46:01.376127+00:00'}
[2025-09-10T13:48:08.111+0000] {dags_utils.py:70} INFO - Received message 16: {'user_id': 298, 'event_type': 'add_to_cart', 'city': 'Antarctica', 'country': 'Antarctica', 'lat': -87.7876275663395, 'lon': 148.51957881322193, 'cost_usd': 974.39, 'cost_eur': 831.14, 'cost_rub': 81445.81, 'weather_temp': -48.37, 'weather_desc': 'overcast clouds', 'timestamp': '2025-09-10T13:46:02.712182+00:00'}
[2025-09-10T13:48:08.111+0000] {dags_utils.py:70} INFO - Received message 17: {'user_id': 51, 'event_type': 'add_to_cart', 'city': "Polohivs'kyi", 'country': 'Ukraine', 'lat': 47.37760130602094, 'lon': 36.368499439830146, 'cost_usd': 240.41, 'cost_eur': 205.07, 'cost_rub': 20095.02, 'weather_temp': 20.19, 'weather_desc': 'overcast clouds', 'timestamp': '2025-09-10T13:46:04.192372+00:00'}
[2025-09-10T13:48:08.111+0000] {dags_utils.py:70} INFO - Received message 18: {'user_id': 919, 'event_type': 'view_product', 'city': 'Nuna Allanngutsaaaliugaq', 'country': 'Greenland', 'lat': 73.75674479372017, 'lon': -21.350568592379034, 'cost_usd': 182.37, 'cost_eur': 155.56, 'cost_rub': 15243.66, 'weather_temp': 2.91, 'weather_desc': 'overcast clouds', 'timestamp': '2025-09-10T13:46:06.515228+00:00'}
[2025-09-10T13:48:08.112+0000] {dags_utils.py:70} INFO - Received message 19: {'user_id': 458, 'event_type': 'purchase', 'city': 'Batsumber', 'country': 'Mongolia', 'lat': 48.307495731807606, 'lon': 106.50821895062666, 'cost_usd': 833.85, 'cost_eur': 711.26, 'cost_rub': 69698.57, 'weather_temp': 7.37, 'weather_desc': 'few clouds', 'timestamp': '2025-09-10T13:46:08.456840+00:00'}
[2025-09-10T13:48:08.112+0000] {dags_utils.py:70} INFO - Received message 20: {'user_id': 257, 'event_type': 'view_product', 'city': 'Көксу', 'country': 'Kazakhstan', 'lat': 44.75628541322192, 'lon': 79.48595586734882, 'cost_usd': 737.96, 'cost_eur': 629.47, 'cost_rub': 61683.46, 'weather_temp': 1.84, 'weather_desc': 'broken clouds', 'timestamp': '2025-09-10T13:46:11.312280+00:00'}
[2025-09-10T13:48:08.112+0000] {dags_utils.py:70} INFO - Received message 21: {'user_id': 694, 'event_type': 'add_to_cart', 'city': 'Antarctica', 'country': 'Antarctica', 'lat': -70.81082645055602, 'lon': -2.7917159131079075, 'cost_usd': 479.66, 'cost_eur': 409.14, 'cost_rub': 40093.08, 'weather_temp': -11.97, 'weather_desc': 'overcast clouds', 'timestamp': '2025-09-10T13:46:15.683152+00:00'}
[2025-09-10T13:48:23.264+0000] {base.py:952} WARNING - Heartbeat failed for group ***_batch_consumer because it is rebalancing
[2025-09-10T13:48:23.274+0000] {consumer.py:366} INFO - Revoking previously assigned partitions (('user_events', 0),) for group ***_batch_consumer
[2025-09-10T13:48:23.275+0000] {base.py:532} INFO - (Re-)joining group ***_batch_consumer
[2025-09-10T13:48:23.289+0000] {base.py:594} INFO - Successfully joined group ***_batch_consumer <Generation 16 (member_id: kafka-python-2.2.15-4df70a1d-c893-4e03-908e-ee6c7ba1c2de, protocol: range)>
[2025-09-10T13:48:23.290+0000] {base.py:597} INFO - Elected group leader -- performing partition assignments using range
[2025-09-10T13:48:23.302+0000] {subscription_state.py:254} INFO - Updated partition assignment: []
[2025-09-10T13:48:23.303+0000] {consumer.py:250} INFO - Setting newly assigned partitions () for group ***_batch_consumer
[2025-09-10T13:48:38.153+0000] {dags_utils.py:93} INFO - [SUCCESS] Inserted 21 rows into raw.events
[2025-09-10T13:48:38.156+0000] {base.py:1052} INFO - Stopping heartbeat thread
[2025-09-10T13:48:38.160+0000] {base.py:891} INFO - Leaving consumer group (***_batch_consumer).
[2025-09-10T13:48:38.190+0000] {base.py:907} INFO - LeaveGroup request for group ***_batch_consumer returned successfully
[2025-09-10T13:48:38.192+0000] {conn.py:945} INFO - <BrokerConnection client_id=kafka-python-2.2.15, node_id=1 host=host.docker.internal:9092 <connected> [IPv4 ('192.168.65.254', 9092)]>: Closing connection. 
[2025-09-10T13:48:38.195+0000] {conn.py:945} INFO - <BrokerConnection client_id=kafka-python-2.2.15, node_id=coordinator-1 host=host.docker.internal:9092 <connected> [IPv4 ('192.168.65.254', 9092)]>: Closing connection. 
[2025-09-10T13:48:38.198+0000] {python.py:183} INFO - Done. Returned value was: None
[2025-09-10T13:48:38.458+0000] {taskinstance.py:1350} INFO - Marking task as SUCCESS. dag_id=kafka_to_postgres_batch, task_id=consume_and_save_batch, execution_date=20250910T134744, start_date=20250910T134803, end_date=20250910T134838
[2025-09-10T13:48:38.621+0000] {local_task_job_runner.py:225} INFO - Task exited with return code 0
[2025-09-10T13:48:38.757+0000] {taskinstance.py:2653} INFO - 0 downstream tasks scheduled from follow-on schedule check
